(window.webpackJsonp=window.webpackJsonp||[]).push([["views-Upload","components-ItdTypeAhead-VueBootstrapTypeahead"],{"050f":function(e,t,r){"use strict";function n(){if(!f&&!(f="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return f(m)}function o(e,t,r,n,o,a,s){var i,l;try{l=(i=e[a](s)).value}catch(c){return void r(c)}i.done?t(l):Promise.resolve(l).then(n,o)}function a(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)),n}function s(e){var t,r;for(t=1;t<arguments.length;t++)r=null!=arguments[t]?arguments[t]:{},t%2?a(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}));return e}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var l,c,u,d,p,f,m,h,b,v,g,y,_,O,w,P;for(r.r(t),l=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("api-request",{attrs:{resource:e.uploadGetLocal,params:e.localModel},model:{value:e.fields,callback:function(t){e.fields=t},expression:"fields"}},[r("itd-form",{attrs:{horizontal:"",cols:"1",form:e.form,config:{}},model:{value:e.upload,callback:function(t){e.upload=t},expression:"upload"}}),r("itd-view",{ref:"table",attrs:{"no-filter":"","no-detail-field":"","get-fields":e.fields,items:e.localItems,"no-crud":"","no-form":"","no-specs":"","no-reload":""}}),r("b-btn",{staticClass:"mt-3",attrs:{variant:"primary",disabled:0===e.localItems.length},on:{click:e.localUploadFile}},[e._v(" Cargar Archivo ")]),r("hr"),r("h5",[e._v("Tiempo Transcurrido: "+e._s(e._f("time")(e.elapsed)))]),r("h5",[e._v("ETA: "+e._s(e._f("time")(e.eta)))]),r("b-progress",{attrs:{max:e.total,value:e.count}},[r("b-progress-bar",{attrs:{value:e.count,label:e.count+"/"+e.total}})],1),e.result?r("itd-view",{ref:"result",attrs:{"no-filter":"","no-detail-field":"","get-fields":e.resultFields,items:e.result,"no-crud":"","no-form":"","no-specs":""}}):e._e()],1)},c=[],u=r("ac0d"),d=r.n(u),p=r("a7d6"),m=new Uint8Array(16),h=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,b=function(e){return"string"==typeof e&&h.test(e)},v=[],g=0;g<256;++g)v.push((g+256).toString(16).substr(1));y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(v[e[t+0]]+v[e[t+1]]+v[e[t+2]]+v[e[t+3]]+"-"+v[e[t+4]]+v[e[t+5]]+"-"+v[e[t+6]]+v[e[t+7]]+"-"+v[e[t+8]]+v[e[t+9]]+"-"+v[e[t+10]]+v[e[t+11]]+v[e[t+12]]+v[e[t+13]]+v[e[t+14]]+v[e[t+15]]).toLowerCase();if(!b(r))throw TypeError("Stringified UUID is invalid");return r},_=function(e,t,r){var o,a;if((o=(e=e||{}).random||(e.rng||n)())[6]=15&o[6]|64,o[8]=63&o[8]|128,t){for(r=r||0,a=0;a<16;++a)t[r+a]=o[a];return t}return y(o)},O={$lodash:"zipObject",$BVP:["ProgressPlugin","ButtonPlugin"],filters:{time:function(e){return moment.utc(e).format("HH:mm:ss")}},props:{getUpload:{type:[Array,Function],default:null},uploadFile:{type:Function,default:null}},data:function(){return{elapsed:0,startTime:0,eta:0,form:[{name:"file",type:"file",accept:".tsv, .csv",label:"Archivo a Cargar"},{name:"firstLine",type:"boolean",label:"Eliminar Primera Línea"},{type:"boolean",name:"all",label:"Mostrar todo?",description:"Si este valor es positivo entonces se muestran todos los resultados, de lo contrario sólo los errores"}],upload:{file:null,firstLine:!0},fields:[],items:[],result:null,count:0,total:0,resultFields:[{key:"status",label:"resultado",component:"string"},{key:"id",label:"identificador",component:"string"},{key:"message",label:"Mensaje",component:"string"}]}},computed:{localModel:function(){return"".concat(this.model,".upload")},zip:function(){return this.fields.map((function(e){return e.key}))},localItems:function(){var e,t=this;return e=this.upload.firstLine&&this.items.length?this.items.slice(1):this.items.slice(),e.map((function(e){return zipObject(t.zip,e)}))}},watch:{"upload.file":function(e,t){var r,n=this;e!==t&&e instanceof File&&((r=new FileReader).onload=function(e){var t=e.target.result;t=t.trim().split(/[\n\r]+/).map((function(e){return e.split(/[,;\t]/)})),n.items=t,n.total=n.localItems.length,n.count=0,n.result=null,n.$refs.table.refreshTable()},r.readAsText(e))},"upload.firstLine":function(){this.total=this.localItems.length,this.count=0,this.$refs.table.refreshTable()},elapsed:function(e){var t,r;e&&(t=this.elapsed/this.count,r=this.total-this.count,this.eta=t*r)}},methods:s(s({},Object(p.b)("form",["uploadSet","uploadGet"])),{},{localUploadFile:function(){var e,t=this;return(e=d.a.mark((function e(){var r,n,o,a,s,i,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=_(),o=t.upload.all,t.result=[],t.count=0,t.total=t.localItems.length,!t.uploadFile){e.next=7;break}return e.abrupt("return",t.uploadFile(s));case 7:return a=t.localModel,s=t.localItems,i=Object({NODE_ENV:"production",VUE_APP_HOST:"",VUE_APP_PROTOCOL:"http",BASE_URL:"/"}).VUE_APP_baseURL||"",l=t.$sse.create({url:"".concat(i,"/APP/AAA/").concat(t.model,".sse")}),e.next=12,l.connect();case 12:return l.on("error",(function(e){console.error("SSE",e),clearInterval(r),l.disconnect()})),l.on(n,(function(e){var n=e.status;switch(r||(t.startTime=Date.now(),r=setInterval((function(){return t.elapsed=Date.now()-t.startTime}),1e3)),n){case"OK":t.count++,o&&t.result.push(e),t.$refs.result.refreshTableDebounce();break;case"ADD_TO_TOTAL":t.total+=e.value;break;case"ERROR":t.count++,t.result.push(e),t.$refs.result.refreshTableDebounce();break;case"DONE":clearInterval(r),t.sse.disconnect(),t.$store.dispatch("Alert/success","Operación Terminada");break;default:t.$store.dispatch("Alert/error","Status no reconocido: ".concat(JSON.stringify(e)))}})),e.next=16,t.uploadSet({model:a,data:s,config:{params:{uuid:n}}});case 16:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,a){function s(e){o(l,n,a,s,i,"next",e)}function i(e){o(l,n,a,s,i,"throw",e)}var l=e.apply(t,r);s(void 0)}))})()},uploadGetLocal:function(e){return this.getUpload?"function"==typeof this.getUpload?this.getUpload(e):this.getUpload:this.uploadGet({model:e})}})},w=r("2a6f"),P=Object(w.a)(O,l,c,!1,null,null,null),t.default=P.exports},"2a6f":function(e,t,r){"use strict";function n(e,t,r,n,o,a,s,i){var l,c,u,d="function"==typeof e?e.options:e;return t&&(d.render=t,d.staticRenderFns=r,d._compiled=!0),n&&(d.functional=!0),a&&(d._scopeId="data-v-"+a),s?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},d._ssrRegister=l):o&&(l=i?function(){o.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:o),l&&(d.functional?(d._injectStyles=l,c=d.render,d.render=function(e,t){return l.call(t),c(e,t)}):(u=d.beforeCreate,d.beforeCreate=u?[].concat(u,l):[l])),{exports:e,options:d}}r.d(t,"a",(function(){return n}))}}]);